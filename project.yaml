version: '3.0'

expectations:

  population_size: 100000

actions:

  ## #################################### 
  ## preliminaries 
  ## #################################### 

  design:
    run: r:latest analysis/design.R
    outputs:
      moderately_sensitive:
        study_dates_json: output/lib/study_parameters.json
        study_dates_rds: output/lib/study_parameters.rds
        jcvi_groups: output/lib/jcvi_groups.csv
        elig_dates: output/lib/elig_dates.csv
        regions: output/lib/regions.csv
        model_varlist: output/lib/model_varlist.rds
        outcomes: output/lib/outcomes.rds

  ## #################################### 
  ## study definition 
  ## #################################### 
  ## generate dummy data for study_definition 

  dummy_data:
    run: r:latest analysis/dummy_data.R
    needs:
    - design
    outputs:
      moderately_sensitive:
        dummy_data: analysis/dummy_data.feather

  ## study definition 

  generate_study_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
      --output-format feather
    dummy_data_file: analysis/dummy_data.feather
    needs:
    - design
    - dummy_data
    outputs:
      highly_sensitive:
        cohort: output/input.feather

  ## #################################### 
  ## preprocessing 
  ## #################################### 
  ## process data from study_definition 

  data_input_process:
    run: r:latest analysis/preprocess/data_input_process.R
    needs:
    - design
    - dummy_data
    - generate_study_population
    outputs:
      highly_sensitive:
        data_covs: output/data/data_covs.rds
        data_vax_dates: output/data/data_*_vax_dates.rds
        data_long_dates: output/data/data_long_*_dates.rds
        data_covid_any: output/data/data_covid_any.rds
      moderately_sensitive:
        data_properties: output/tables/data_processed_tabulate.txt

  ## apply eligiblity criteria from boxes a and b 

  data_eligible_ab:
    run: r:latest analysis/preprocess/data_eligible_ab.R
    needs:
    - design
    - data_input_process
    outputs:
      highly_sensitive:
        data_eligible_a: output/data/data_eligible_a.rds
        data_eligible_b: output/data/data_eligible_b.rds
      moderately_sensitive:
        eligibility_count: output/lib/eligibility_count_ab.csv
        group_age_ranges: output/lib/group_age_ranges.csv

  ## #################################### 
  ## second_vax_period 
  ## #################################### 
  ## identify second vaccination time periods 
  ## create dataset for identifying second vaccination time periods 

  data_2nd_vax_dates:
    run: r:latest analysis/second_vax_period/data_2nd_vax_dates.R
    needs:
    - design
    - data_input_process
    - data_eligible_ab
    outputs:
      highly_sensitive:
        data_vax_plot: output/second_vax_period/data/data_vax_plot.rds
        second_vax_period_dates_rds: output/lib/second_vax_period_dates.rds
      moderately_sensitive:
        second_vax_period_dates_txt: output/tables/second_vax_period_dates.txt

  ## plot second vaccination time periods 

  plot_2nd_vax_dates:
    run: r:latest analysis/second_vax_period/plot_2nd_vax_dates.R
    needs:
    - design
    - data_eligible_ab
    - data_2nd_vax_dates
    outputs:
      moderately_sensitive:
        plots_by_region: output/second_vax_period/images/plot_by_region_*.png

  ## apply eligiblity criteria from boxes c and d 

  data_eligible_cd:
    run: r:latest analysis/second_vax_period/data_eligible_cd.R
    needs:
    - design
    - data_input_process
    - data_eligible_ab
    - data_2nd_vax_dates
    outputs:
      highly_sensitive:
        data_eligible_c: output/data/data_eligible_c.rds
        data_eligible_d: output/data/data_eligible_d.rds

  ## #################################### 
  ## comparisons 
  ## #################################### 
  ## process comparisons data 

  data_comparisons_process:
    run: r:latest analysis/comparisons/data_comparisons_process.R
    needs:
    - design
    - data_input_process
    - data_2nd_vax_dates
    - data_eligible_cd
    outputs:
      highly_sensitive:
        data_comparisons: output/data/data_comparisons_*.rds

  ## process outcomes data 

  data_outcomes_process:
    run: r:latest analysis/comparisons/data_outcomes_process.R
    needs:
    - design
    - data_input_process
    - data_comparisons_process
    outputs:
      highly_sensitive:
        data_outcomes: output/data/data_outcomes_*.rds

  ## process tte data 

  data_tte_process:
    run: r:latest analysis/comparisons/data_tte_process.R
    needs:
    - design
    - data_comparisons_process
    - data_outcomes_process
    outputs:
      highly_sensitive:
        data_tte_brand_outcome: output/data/data_tte_*.rds

  ## apply models 
  ## subgroup = 02, comparison = BNT162b2, outcome = postest 

  apply_model_cox_02_BNT162b2_postest:
    run: r:latest analysis/comparisons/apply_model_cox.R 02 BNT162b2 postest
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_02_BNT162b2_postest.rds
        model_summary_rds: output/models/modelcox_summary_02_BNT162b2_postest.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_02_BNT162b2_postest_all.txt
        incidence_table_strata: output/tables/incidence_02_BNT162b2_postest_strata.txt
        model_glance: output/models/modelcox_glance_02_BNT162b2_postest.csv

  ## subgroup = 02, comparison = BNT162b2, outcome = covidadmitted 

  apply_model_cox_02_BNT162b2_covidadmitted:
    run: r:latest analysis/comparisons/apply_model_cox.R 02 BNT162b2 covidadmitted
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_02_BNT162b2_covidadmitted.rds
        model_summary_rds: output/models/modelcox_summary_02_BNT162b2_covidadmitted.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_02_BNT162b2_covidadmitted_all.txt
        incidence_table_strata: output/tables/incidence_02_BNT162b2_covidadmitted_strata.txt
        model_glance: output/models/modelcox_glance_02_BNT162b2_covidadmitted.csv

  ## subgroup = 02, comparison = BNT162b2, outcome = coviddeath 

  apply_model_cox_02_BNT162b2_coviddeath:
    run: r:latest analysis/comparisons/apply_model_cox.R 02 BNT162b2 coviddeath
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_02_BNT162b2_coviddeath.rds
        model_summary_rds: output/models/modelcox_summary_02_BNT162b2_coviddeath.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_02_BNT162b2_coviddeath_all.txt
        incidence_table_strata: output/tables/incidence_02_BNT162b2_coviddeath_strata.txt
        model_glance: output/models/modelcox_glance_02_BNT162b2_coviddeath.csv

  ## subgroup = 02, comparison = BNT162b2, outcome = death 

  apply_model_cox_02_BNT162b2_death:
    run: r:latest analysis/comparisons/apply_model_cox.R 02 BNT162b2 death
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_02_BNT162b2_death.rds
        model_summary_rds: output/models/modelcox_summary_02_BNT162b2_death.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_02_BNT162b2_death_all.txt
        incidence_table_strata: output/tables/incidence_02_BNT162b2_death_strata.txt
        model_glance: output/models/modelcox_glance_02_BNT162b2_death.csv

  ## subgroup = 03-10, comparison = BNT162b2, outcome = postest 

  apply_model_cox_03-10_BNT162b2_postest:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 BNT162b2 postest
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_BNT162b2_postest.rds
        model_summary_rds: output/models/modelcox_summary_03-10_BNT162b2_postest.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_BNT162b2_postest_all.txt
        incidence_table_strata: output/tables/incidence_03-10_BNT162b2_postest_strata.txt
        model_glance: output/models/modelcox_glance_03-10_BNT162b2_postest.csv

  ## subgroup = 03-10, comparison = BNT162b2, outcome = covidadmitted 

  apply_model_cox_03-10_BNT162b2_covidadmitted:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 BNT162b2 covidadmitted
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_BNT162b2_covidadmitted.rds
        model_summary_rds: output/models/modelcox_summary_03-10_BNT162b2_covidadmitted.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_BNT162b2_covidadmitted_all.txt
        incidence_table_strata: output/tables/incidence_03-10_BNT162b2_covidadmitted_strata.txt
        model_glance: output/models/modelcox_glance_03-10_BNT162b2_covidadmitted.csv

  ## subgroup = 03-10, comparison = BNT162b2, outcome = coviddeath 

  apply_model_cox_03-10_BNT162b2_coviddeath:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 BNT162b2 coviddeath
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_BNT162b2_coviddeath.rds
        model_summary_rds: output/models/modelcox_summary_03-10_BNT162b2_coviddeath.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_BNT162b2_coviddeath_all.txt
        incidence_table_strata: output/tables/incidence_03-10_BNT162b2_coviddeath_strata.txt
        model_glance: output/models/modelcox_glance_03-10_BNT162b2_coviddeath.csv

  ## subgroup = 03-10, comparison = BNT162b2, outcome = death 

  apply_model_cox_03-10_BNT162b2_death:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 BNT162b2 death
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_BNT162b2_death.rds
        model_summary_rds: output/models/modelcox_summary_03-10_BNT162b2_death.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_BNT162b2_death_all.txt
        incidence_table_strata: output/tables/incidence_03-10_BNT162b2_death_strata.txt
        model_glance: output/models/modelcox_glance_03-10_BNT162b2_death.csv

  ## subgroup = 03-10, comparison = ChAdOx, outcome = postest 

  apply_model_cox_03-10_ChAdOx_postest:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 ChAdOx postest
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_ChAdOx_postest.rds
        model_summary_rds: output/models/modelcox_summary_03-10_ChAdOx_postest.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_ChAdOx_postest_all.txt
        incidence_table_strata: output/tables/incidence_03-10_ChAdOx_postest_strata.txt
        model_glance: output/models/modelcox_glance_03-10_ChAdOx_postest.csv

  ## subgroup = 03-10, comparison = ChAdOx, outcome = covidadmitted 

  apply_model_cox_03-10_ChAdOx_covidadmitted:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 ChAdOx covidadmitted
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_ChAdOx_covidadmitted.rds
        model_summary_rds: output/models/modelcox_summary_03-10_ChAdOx_covidadmitted.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_ChAdOx_covidadmitted_all.txt
        incidence_table_strata: output/tables/incidence_03-10_ChAdOx_covidadmitted_strata.txt
        model_glance: output/models/modelcox_glance_03-10_ChAdOx_covidadmitted.csv

  ## subgroup = 03-10, comparison = ChAdOx, outcome = coviddeath 

  apply_model_cox_03-10_ChAdOx_coviddeath:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 ChAdOx coviddeath
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_ChAdOx_coviddeath.rds
        model_summary_rds: output/models/modelcox_summary_03-10_ChAdOx_coviddeath.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_ChAdOx_coviddeath_all.txt
        incidence_table_strata: output/tables/incidence_03-10_ChAdOx_coviddeath_strata.txt
        model_glance: output/models/modelcox_glance_03-10_ChAdOx_coviddeath.csv

  ## subgroup = 03-10, comparison = ChAdOx, outcome = death 

  apply_model_cox_03-10_ChAdOx_death:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 ChAdOx death
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_ChAdOx_death.rds
        model_summary_rds: output/models/modelcox_summary_03-10_ChAdOx_death.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_ChAdOx_death_all.txt
        incidence_table_strata: output/tables/incidence_03-10_ChAdOx_death_strata.txt
        model_glance: output/models/modelcox_glance_03-10_ChAdOx_death.csv

  ## subgroup = 03-10, comparison = both, outcome = postest 

  apply_model_cox_03-10_both_postest:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 both postest
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_both_postest.rds
        model_summary_rds: output/models/modelcox_summary_03-10_both_postest.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_both_postest_all.txt
        incidence_table_strata: output/tables/incidence_03-10_both_postest_strata.txt
        model_glance: output/models/modelcox_glance_03-10_both_postest.csv

  ## subgroup = 03-10, comparison = both, outcome = covidadmitted 

  apply_model_cox_03-10_both_covidadmitted:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 both covidadmitted
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_both_covidadmitted.rds
        model_summary_rds: output/models/modelcox_summary_03-10_both_covidadmitted.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_both_covidadmitted_all.txt
        incidence_table_strata: output/tables/incidence_03-10_both_covidadmitted_strata.txt
        model_glance: output/models/modelcox_glance_03-10_both_covidadmitted.csv

  ## subgroup = 03-10, comparison = both, outcome = coviddeath 

  apply_model_cox_03-10_both_coviddeath:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 both coviddeath
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_both_coviddeath.rds
        model_summary_rds: output/models/modelcox_summary_03-10_both_coviddeath.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_both_coviddeath_all.txt
        incidence_table_strata: output/tables/incidence_03-10_both_coviddeath_strata.txt
        model_glance: output/models/modelcox_glance_03-10_both_coviddeath.csv

  ## subgroup = 03-10, comparison = both, outcome = death 

  apply_model_cox_03-10_both_death:
    run: r:latest analysis/comparisons/apply_model_cox.R 03-10 both death
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_03-10_both_death.rds
        model_summary_rds: output/models/modelcox_summary_03-10_both_death.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_03-10_both_death_all.txt
        incidence_table_strata: output/tables/incidence_03-10_both_death_strata.txt
        model_glance: output/models/modelcox_glance_03-10_both_death.csv

  ## subgroup = 11-12, comparison = BNT162b2, outcome = postest 

  apply_model_cox_11-12_BNT162b2_postest:
    run: r:latest analysis/comparisons/apply_model_cox.R 11-12 BNT162b2 postest
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_11-12_BNT162b2_postest.rds
        model_summary_rds: output/models/modelcox_summary_11-12_BNT162b2_postest.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_11-12_BNT162b2_postest_all.txt
        incidence_table_strata: output/tables/incidence_11-12_BNT162b2_postest_strata.txt
        model_glance: output/models/modelcox_glance_11-12_BNT162b2_postest.csv

  ## subgroup = 11-12, comparison = BNT162b2, outcome = covidadmitted 

  apply_model_cox_11-12_BNT162b2_covidadmitted:
    run: r:latest analysis/comparisons/apply_model_cox.R 11-12 BNT162b2 covidadmitted
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_11-12_BNT162b2_covidadmitted.rds
        model_summary_rds: output/models/modelcox_summary_11-12_BNT162b2_covidadmitted.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_11-12_BNT162b2_covidadmitted_all.txt
        incidence_table_strata: output/tables/incidence_11-12_BNT162b2_covidadmitted_strata.txt
        model_glance: output/models/modelcox_glance_11-12_BNT162b2_covidadmitted.csv

  ## subgroup = 11-12, comparison = BNT162b2, outcome = coviddeath 

  apply_model_cox_11-12_BNT162b2_coviddeath:
    run: r:latest analysis/comparisons/apply_model_cox.R 11-12 BNT162b2 coviddeath
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_11-12_BNT162b2_coviddeath.rds
        model_summary_rds: output/models/modelcox_summary_11-12_BNT162b2_coviddeath.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_11-12_BNT162b2_coviddeath_all.txt
        incidence_table_strata: output/tables/incidence_11-12_BNT162b2_coviddeath_strata.txt
        model_glance: output/models/modelcox_glance_11-12_BNT162b2_coviddeath.csv

  ## subgroup = 11-12, comparison = BNT162b2, outcome = death 

  apply_model_cox_11-12_BNT162b2_death:
    run: r:latest analysis/comparisons/apply_model_cox.R 11-12 BNT162b2 death
    needs:
    - design
    - data_comparisons_process
    - data_tte_process
    outputs:
      highly_sensitive:
        modelnumber: output/models/model*_11-12_BNT162b2_death.rds
        model_summary_rds: output/models/modelcox_summary_11-12_BNT162b2_death.rds
      moderately_sensitive:
        incidence_table_all: output/tables/incidence_11-12_BNT162b2_death_all.txt
        incidence_table_strata: output/tables/incidence_11-12_BNT162b2_death_strata.txt
        model_glance: output/models/modelcox_glance_11-12_BNT162b2_death.csv

  ## generate tables 
  ## tabulate cox model for all outcomes 

  tables_model_cox_02_BNT162b2:
    run: r:latest analysis/comparisons/tables_cox.R 02 BNT162b2
    needs:
    - design
    - data_2nd_vax_dates
    - data_tte_process
    - apply_model_cox_02_BNT162b2_postest
    - apply_model_cox_02_BNT162b2_covidadmitted
    - apply_model_cox_02_BNT162b2_coviddeath
    - apply_model_cox_02_BNT162b2_death
    outputs:
      moderately_sensitive:
        table_glance: output/tables/modelcox_glance_02_BNT162b2.txt
        table_coefficients: output/tables/modelcox_coefficients_02_BNT162b2.txt

  ## tabulate cox model for all outcomes 

  tables_model_cox_03-10_BNT162b2:
    run: r:latest analysis/comparisons/tables_cox.R 03-10 BNT162b2
    needs:
    - design
    - data_2nd_vax_dates
    - data_tte_process
    - apply_model_cox_03-10_BNT162b2_postest
    - apply_model_cox_03-10_BNT162b2_covidadmitted
    - apply_model_cox_03-10_BNT162b2_coviddeath
    - apply_model_cox_03-10_BNT162b2_death
    outputs:
      moderately_sensitive:
        table_glance: output/tables/modelcox_glance_03-10_BNT162b2.txt
        table_coefficients: output/tables/modelcox_coefficients_03-10_BNT162b2.txt

  ## tabulate cox model for all outcomes 

  tables_model_cox_03-10_ChAdOx:
    run: r:latest analysis/comparisons/tables_cox.R 03-10 ChAdOx
    needs:
    - design
    - data_2nd_vax_dates
    - data_tte_process
    - apply_model_cox_03-10_ChAdOx_postest
    - apply_model_cox_03-10_ChAdOx_covidadmitted
    - apply_model_cox_03-10_ChAdOx_coviddeath
    - apply_model_cox_03-10_ChAdOx_death
    outputs:
      moderately_sensitive:
        table_glance: output/tables/modelcox_glance_03-10_ChAdOx.txt
        table_coefficients: output/tables/modelcox_coefficients_03-10_ChAdOx.txt

  ## tabulate cox model for all outcomes 

  tables_model_cox_03-10_both:
    run: r:latest analysis/comparisons/tables_cox.R 03-10 both
    needs:
    - design
    - data_2nd_vax_dates
    - data_tte_process
    - apply_model_cox_03-10_both_postest
    - apply_model_cox_03-10_both_covidadmitted
    - apply_model_cox_03-10_both_coviddeath
    - apply_model_cox_03-10_both_death
    outputs:
      moderately_sensitive:
        table_glance: output/tables/modelcox_glance_03-10_both.txt
        table_coefficients: output/tables/modelcox_coefficients_03-10_both.txt

  ## tabulate cox model for all outcomes 

  tables_model_cox_11-12_BNT162b2:
    run: r:latest analysis/comparisons/tables_cox.R 11-12 BNT162b2
    needs:
    - design
    - data_2nd_vax_dates
    - data_tte_process
    - apply_model_cox_11-12_BNT162b2_postest
    - apply_model_cox_11-12_BNT162b2_covidadmitted
    - apply_model_cox_11-12_BNT162b2_coviddeath
    - apply_model_cox_11-12_BNT162b2_death
    outputs:
      moderately_sensitive:
        table_glance: output/tables/modelcox_glance_11-12_BNT162b2.txt
        table_coefficients: output/tables/modelcox_coefficients_11-12_BNT162b2.txt

  ## generate plots 
  ## plot BNT162b2 

  plot_model_cox_BNT162b2:
    run: r:latest analysis/comparisons/plot_cox.R BNT162b2
    needs:
    - design
    - data_2nd_vax_dates
    - apply_model_cox_02_BNT162b2_postest
    - apply_model_cox_02_BNT162b2_covidadmitted
    - apply_model_cox_02_BNT162b2_coviddeath
    - apply_model_cox_02_BNT162b2_death
    - apply_model_cox_03-10_BNT162b2_postest
    - apply_model_cox_03-10_BNT162b2_covidadmitted
    - apply_model_cox_03-10_BNT162b2_coviddeath
    - apply_model_cox_03-10_BNT162b2_death
    - apply_model_cox_11-12_BNT162b2_postest
    - apply_model_cox_11-12_BNT162b2_covidadmitted
    - apply_model_cox_11-12_BNT162b2_coviddeath
    - apply_model_cox_11-12_BNT162b2_death
    outputs:
      moderately_sensitive:
        plot: output/images/plot_res_BNT162b2.png

  ## plot ChAdOx 

  plot_model_cox_ChAdOx:
    run: r:latest analysis/comparisons/plot_cox.R ChAdOx
    needs:
    - design
    - data_2nd_vax_dates
    - apply_model_cox_03-10_ChAdOx_postest
    - apply_model_cox_03-10_ChAdOx_covidadmitted
    - apply_model_cox_03-10_ChAdOx_coviddeath
    - apply_model_cox_03-10_ChAdOx_death
    outputs:
      moderately_sensitive:
        plot: output/images/plot_res_ChAdOx.png

  ## plot BNT162b2andChAdOx 

  plot_model_cox_BNT162b2andChAdOx:
    run: r:latest analysis/comparisons/plot_cox.R BNT162b2andChAdOx
    needs:
    - design
    - data_2nd_vax_dates
    - apply_model_cox_03-10_BNT162b2_postest
    - apply_model_cox_03-10_BNT162b2_covidadmitted
    - apply_model_cox_03-10_BNT162b2_coviddeath
    - apply_model_cox_03-10_BNT162b2_death
    - apply_model_cox_03-10_ChAdOx_postest
    - apply_model_cox_03-10_ChAdOx_covidadmitted
    - apply_model_cox_03-10_ChAdOx_coviddeath
    - apply_model_cox_03-10_ChAdOx_death
    outputs:
      moderately_sensitive:
        plot: output/images/plot_res_BNT162b2andChAdOx.png

  ## plot BNT162b2vsChAdOx 

  plot_model_cox_BNT162b2vsChAdOx:
    run: r:latest analysis/comparisons/plot_cox.R BNT162b2vsChAdOx
    needs:
    - design
    - data_2nd_vax_dates
    - apply_model_cox_03-10_both_postest
    - apply_model_cox_03-10_both_covidadmitted
    - apply_model_cox_03-10_both_coviddeath
    - apply_model_cox_03-10_both_death
    outputs:
      moderately_sensitive:
        plot: output/images/plot_res_BNT162b2vsChAdOx.png

  ## combine all incidence tables 

  combine_incidence_tables:
    run: r:latest analysis/comparisons/combine_incidence_tables.R
    needs:
    - design
    - apply_model_cox_02_BNT162b2_postest
    - apply_model_cox_02_BNT162b2_covidadmitted
    - apply_model_cox_02_BNT162b2_coviddeath
    - apply_model_cox_02_BNT162b2_death
    - apply_model_cox_03-10_BNT162b2_postest
    - apply_model_cox_03-10_BNT162b2_covidadmitted
    - apply_model_cox_03-10_BNT162b2_coviddeath
    - apply_model_cox_03-10_BNT162b2_death
    - apply_model_cox_03-10_ChAdOx_postest
    - apply_model_cox_03-10_ChAdOx_covidadmitted
    - apply_model_cox_03-10_ChAdOx_coviddeath
    - apply_model_cox_03-10_ChAdOx_death
    - apply_model_cox_03-10_both_postest
    - apply_model_cox_03-10_both_covidadmitted
    - apply_model_cox_03-10_both_coviddeath
    - apply_model_cox_03-10_both_death
    - apply_model_cox_11-12_BNT162b2_postest
    - apply_model_cox_11-12_BNT162b2_covidadmitted
    - apply_model_cox_11-12_BNT162b2_coviddeath
    - apply_model_cox_11-12_BNT162b2_death
    outputs:
      moderately_sensitive:
        incidence_all: output/tables/incidence_all.txt

